!function(globals){"use strict";var DVSA={Modules:{},Utilities:{},Events:!1,init:function(events){var x;this.Events=events||!1;for(x in DVSA.Modules)DVSA.Modules.hasOwnProperty(x)&&"function"==typeof DVSA.Modules[x].init&&DVSA.Modules[x].init()}};globals.DVSA=DVSA}(this),function(dvsaMotFrontendAuthentication,$,undefined){dvsaMotFrontendAuthentication.keepSessionAlive=function(timeOut){var timeOut="undefined"!=typeof timeOut?parseInt(timeOut):60;timeOut<=0||setInterval(function(){$.get(window.location.href)},1e3*timeOut)},dvsaMotFrontendAuthentication.addNonAutocompleteFields=function(){var usernameField=$("#IDToken1").eq(0),passwordField=$("#IDToken2").eq(0),form=$("#Login").eq(0),uniqueId=(new Date).getTime(),fakeUsernameField=usernameField.clone().prop({id:uniqueId+"_tid1",name:uniqueId+"_tid1",tabindex:1}).insertAfter(usernameField),fakePasswordField=passwordField.clone().prop({id:uniqueId+"_tid2",name:uniqueId+"_tid2",tabindex:2}).insertAfter(passwordField);$.each([usernameField,passwordField],function(k,field){setTimeout(function(){field.val("")},250),field.css({width:"1px",position:"absolute",left:"-9999px"}),field.prop("tabindex",-1)}),form.prop("id",uniqueId+"_tid_form"),form.prop("autocomplete","off"),fakeUsernameField.focus(),form.submit(function(event){return usernameField.val(fakeUsernameField.val()),passwordField.val(fakePasswordField.val()),!0})}}(window.dvsaMotFrontendAuthentication=window.dvsaMotFrontendAuthentication||{},jQuery),$(document).ready(function(){dvsaMotFrontendAuthentication.addNonAutocompleteFields()}),function(globals){"use strict";var init,Criteria;globals.DVSA||{};Criteria=function(options){var options=options||{};this.trigger=options.trigger||null,this.scope=options.criteria||null,this.stateNeutral="criteria__criterion",this.stateFail="criteria__criterion--has-failed",this.statePass="criteria__criterion--has-passed",this.criteria=[],this.getCriteria(),this.bindEvents()},Criteria.prototype.getCriteria=function(){for(var criteriaElements=globals.document.querySelectorAll("[data-criteria]"),i=0;i<criteriaElements.length;i++){var criteriaName=criteriaElements[i].getAttribute("data-criteria"),criteriaParam=criteriaElements[i].getAttribute("data-criteria-param")||null;this.criteria.push({name:criteriaName,param:criteriaParam,state:criteriaElements[i].className,element:criteriaElements[i]})}},Criteria.prototype.bindEvents=function(){var self=this;globals.window.addEventListener?(this.trigger.addEventListener("keyup",function(){self.checkCriteria()}),this.trigger.addEventListener("paste",function(){self.checkCriteria()})):globals.window.attachEvent&&(this.trigger.attachEvent("onkeyup",function(){self.checkCriteria()}),this.trigger.attachEvent("onpaste",function(){self.checkCriteria()}))},Criteria.prototype.checkCriteria=function(){for(var currentValue=this.trigger.value,i=0;i<this.criteria.length;i++){var criteriaName=this.criteria[i].name,criteriaParam=this.criteria[i].param,status=this[criteriaName](currentValue,criteriaParam);this.decorateElement(i,status)}},Criteria.prototype.decorateElement=function(i,state){this.criteria[i].state!=state&&(this.criteria[i].state=state,this.criteria[i].element.className=state)},Criteria.prototype.hasMixedCase=function(val){var cssClass=this.stateNeutral;return/^(?=.*[a-z])(?=.*[A-Z]).+$/.test(val)&&(cssClass=this.statePass),cssClass},Criteria.prototype.minLength=function(val,param){var cssClass=this.stateNeutral,regEx=new RegExp("^.{"+param+",}$");return regEx.test(val)&&(cssClass=this.statePass),cssClass},Criteria.prototype.notMatch=function(val,param){var cssClass=this.stateNeutral,val_lc=val.toLowerCase(),param_lc=param.toLowerCase();return val_lc===param_lc&&val_lc.length===param_lc.length?cssClass=this.stateFail:val_lc!=param_lc.substring(0,val_lc.length)&&(cssClass=this.statePass),cssClass},Criteria.prototype.hasNumeric=function(val){var cssClass=this.stateNeutral;return/[0-9]/.test(val)&&(cssClass=this.statePass),cssClass},Criteria.prototype.hasUpperCase=function(val){var cssClass=this.stateNeutral;return/[A-Z]/.test(val)&&(cssClass=this.statePass),cssClass},Criteria.prototype.hasLowerCase=function(val){var cssClass=this.stateNeutral;return/[a-z]/.test(val)&&(cssClass=this.statePass),cssClass},init=function(){},globals.DVSACriteria={init:init,Criteria:Criteria}}(this),function(globals){"use strict";var init,ShowHideToggleRadioClasses;globals.DVSA||{};ShowHideToggleRadioClasses=function(){},ShowHideToggleRadioClasses.prototype.init=function(){var self=this,triggerRadio=$("[data-toggle-class]"),triggerRadioClass=$(triggerRadio).data("toggle-class"),otherRadios=$("input[type=radio]:not([data-toggle-class])");$(triggerRadio).on("click",function(e){self.showToggle(triggerRadioClass)}),$(otherRadios).on("click",function(e){self.hideToggle(triggerRadioClass)})},ShowHideToggleRadioClasses.prototype.showToggle=function(triggerRadioClass){$("."+triggerRadioClass).removeClass("js-hidden")},ShowHideToggleRadioClasses.prototype.hideToggle=function(triggerRadioClass){$("."+triggerRadioClass).addClass("js-hidden")},init=function(){},globals.DVSAShowHideToggleRadioClasses={init:init,showerHiderRadioClasses:ShowHideToggleRadioClasses}}(this),function(globals){"use strict";function isHidden(targetClassName){var firstElementToCheck=$("."+targetClassName).first();return!$(firstElementToCheck).is(":visible")}var init,ShowHideToggleClasses;globals.DVSA||{};ShowHideToggleClasses=function(){},ShowHideToggleClasses.prototype.init=function(){var self=this;this.triggerElements=document.querySelectorAll('[data-action="showHideToggle"]');for(var i=0;i<this.triggerElements.length;i++)!function(){var returnableID="inpageLink_"+(new Date).getTime(),triggerElement=self.triggerElements[i],triggerElementStartText=triggerElement.text,triggerElementOpenText=triggerElement.getAttribute("data-open-text"),targetClassName=triggerElement.getAttribute("data-toggle-class"),toggleType=triggerElement.getAttribute("data-toggle-type"),footerTriggerElement=self.triggerElements[1];triggerElement.setAttribute("data-closed-text",triggerElementStartText),"responsive"!=toggleType&&$("."+targetClassName).addClass(" js-hidden"),window.addEventListener&&(triggerElement.addEventListener("click",function(e){e.preventDefault(),self.checkState(targetClassName,triggerElementStartText,triggerElementOpenText,toggleType,footerTriggerElement,returnableID)}),footerTriggerElement&&$(triggerElement).parents(".defect-summary").attr("id",returnableID))}()},ShowHideToggleClasses.prototype.checkState=function(targetClassName,triggerElementStartText,triggerElementOpenText,toggleType,footerTriggerElement,returnableID){isHidden(targetClassName)?this.showToggle(targetClassName,triggerElementOpenText,toggleType):this.hideToggle(targetClassName,triggerElementStartText,toggleType,footerTriggerElement,returnableID)},ShowHideToggleClasses.prototype.showToggle=function(targetClassName,triggerElementOpenText,toggleType){"responsive"==toggleType?$("."+targetClassName).removeClass("hide-small"):$("."+targetClassName).removeClass("js-hidden"),$('[data-toggle-class="'+targetClassName+'"]').each(function(){$(this).text(triggerElementOpenText),$(this).removeClass("toggle-switch").addClass("toggle-switch--open")})},ShowHideToggleClasses.prototype.hideToggle=function(targetClassName,triggerElementStartText,toggleType,footerTriggerElement,returnableID){"responsive"==toggleType?$("."+targetClassName).addClass("hide-small"):$("."+targetClassName).addClass("js-hidden"),$('[data-toggle-class="'+targetClassName+'"]').each(function(){$(this).text(triggerElementStartText),$(this).removeClass("toggle-switch--open").addClass("toggle-switch")})},init=function(){},globals.DVSAShowHideToggleClasses={init:init,showerHiderClasses:ShowHideToggleClasses}}(this),function(globals){"use strict";function isHidden(el){var style=window.getComputedStyle(el);return"none"===style.display}var init,ShowHideToggle;globals.DVSA||{};ShowHideToggle=function(){},ShowHideToggle.prototype.init=function(){var self=this;this.triggerElements=document.querySelectorAll('[data-action="showHideToggle"]');for(var i=0;i<this.triggerElements.length;i++)!function(){var triggerElement=self.triggerElements[i],triggerElementStartText=triggerElement.text,triggerElementOpenText=triggerElement.getAttribute("data-open-text"),targetId=triggerElement.getAttribute("data-target"),toggleType=triggerElement.getAttribute("data-toggle-type"),targetElement=document.querySelector("#"+targetId),footerTriggerElement=self.triggerElements[1];triggerElement.setAttribute("data-closed-text",triggerElementStartText),"responsive"!=toggleType&&$(targetElement).addClass(" js-hidden"),window.addEventListener&&(triggerElement.addEventListener("click",function(e){e.preventDefault(),self.checkState(triggerElement,targetElement,triggerElementStartText,triggerElementOpenText,toggleType)}),footerTriggerElement&&footerTriggerElement.addEventListener("click",function(e){e.preventDefault(),self.scrollToTable(targetId)}))}()},ShowHideToggle.prototype.checkState=function(triggerElement,targetElement,triggerElementStartText,triggerElementOpenText,toggleType){isHidden(targetElement)?this.showToggle(targetElement,triggerElementOpenText,toggleType):this.hideToggle(targetElement,triggerElementStartText,toggleType)},ShowHideToggle.prototype.showToggle=function(targetElement,triggerElementOpenText,toggleType){"responsive"==toggleType?$(targetElement).removeClass("hide-small"):$(targetElement).removeClass("js-hidden"),$('[data-action="showHideToggle"]').each(function(){$(this).text(triggerElementOpenText),$(this).removeClass("toggle-switch").addClass("toggle-switch--open")})},ShowHideToggle.prototype.hideToggle=function(targetElement,triggerElementStartText,toggleType){"responsive"==toggleType?$(targetElement).addClass("hide-small"):$(targetElement).addClass("js-hidden"),$('[data-action="showHideToggle"]').each(function(){$(this).text(triggerElementStartText),$(this).removeClass("toggle-switch--open").addClass("toggle-switch")})},ShowHideToggle.prototype.scrollToTable=function(targetId){$("#"+targetId+"Parent")[0].scrollIntoView(!0)},init=function(){},globals.DVSAShowHideToggle={init:init,showerHider:ShowHideToggle}}(this),function(globals){"use strict";var MarkRepairs;globals.DVSA||{};MarkRepairs=function(){},MarkRepairs.prototype.init=function(){function updateBrakeTest(brakeTestOutcome,brakesTested,brakeResults,disableSubmitButton){if($(".js-brakeTestActionPanel").length){var $brakeTestStatus=$(".js-brakeTestStatus"),$addBrakeTest=$(".js-addBrakeTest"),$brakeTestActions=$(".js-brakeTestActions"),$reviewTestButton=$(".js-reviewTestButton"),$brakeTestSummary=$(".js-brakeTestSummary");$brakeTestStatus.text(brakeTestOutcome),$brakeTestActions.length&&(!0===brakesTested&&!0===brakeResults?$brakeTestActions.removeClass("u-hidden"):$brakeTestActions.addClass("u-hidden")),$addBrakeTest.length&&(!1===brakesTested||!0===brakeResults?$addBrakeTest.addClass("u-hidden"):$addBrakeTest.removeClass("u-hidden")),$brakeTestSummary.length&&!1===brakesTested&&$brakeTestSummary.remove(),$reviewTestButton.length&&(!0===disableSubmitButton?$reviewTestButton.attr("disabled",!0):$reviewTestButton.attr("disabled",!1))}}function updateCount(type,action){var numberOfFailures=$(".js-numberOfFailures"),valNumberOfFailures=parseInt(numberOfFailures.first().text()),numberOfAdvisories=$(".js-numberOfAdvisories"),valNumberOfAdvisories=parseInt(numberOfAdvisories.first().text());"repair"==action?"advisory"==type&&numberOfAdvisories.length?numberOfAdvisories.text(valNumberOfAdvisories-1):"failure"==type&&numberOfFailures.length&&numberOfFailures.text(valNumberOfFailures-1):"advisory"==type&&numberOfAdvisories.length?numberOfAdvisories.text(valNumberOfAdvisories+1):"failure"==type&&numberOfFailures.length&&numberOfFailures.text(valNumberOfFailures+1)}$(document).on("click",".js-buttonMarkRepaired",function(e){e.preventDefault();var isLoading,self=$(this),rfrForm=self.parents(".js-rfrForm"),url=rfrForm.attr("action")||self.data("url"),formData=rfrForm.serialize()||self.data("form"),rfrItem=self.parents(".js-rfrItem"),itemStatus=rfrItem.find(".js-itemStatus");self.attr("disabled",!0),$.ajax({type:"POST",url:url,data:formData,beforeSend:function(){isLoading=setTimeout(function(){rfrItem.addClass("has-status"),itemStatus.html("Loading")},2e3)},success:function(data){clearTimeout(isLoading),data.success?(rfrItem.removeClass("has-status"),"repair"==data.action?(rfrItem.addClass("has-success"),updateCount(data.defectType,data.action)):(rfrItem.removeClass("has-success"),updateCount(data.defectType,data.action)),updateBrakeTest(data.brakeTestOutcome,data.brakesTested,data.brakeTestResults,data.disableSubmitButton)):(rfrItem.addClass("has-status"),itemStatus.html('That didn\'t work, <a class="js-buttonMarkRepaired" href="" data-url="'+url+'" data-form="'+formData+'">try again</a>'))},error:function(){clearTimeout(isLoading),rfrItem.addClass("has-status"),itemStatus.html('That didn\'t work, <a class="js-buttonMarkRepaired" href="" data-url="'+url+'" data-form="'+formData+'">try again</a>')},complete:function(){self.attr("disabled",!1)}})})},globals.DVSAMarkRepairs={markRepairs:MarkRepairs}}(this),function(globals){"use strict";var CookiesEnabled;globals.DVSA||{};CookiesEnabled=function(){var cookieName="cookeTest";try{document.cookie=cookieName+"=1";var ret=document.cookie.indexOf(cookieName+"=")!=-1;return document.cookie=cookieName+"=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",ret}catch(e){return!1}},globals.DVSACookiesEnabled={CookiesEnabled:CookiesEnabled}}(this),function(globals){"use strict";var start,doubleClickPrevention,DoubleClickPrevention;globals.DVSA||{};DoubleClickPrevention=function(){},DoubleClickPrevention.prototype.start=function(){var validatedForms={};$(".prevent-double-click-form").submit(function(e){if(validatedForms.hasOwnProperty(this.name))return e.preventDefault(),!1;validatedForms[this.name]=!0;var submitId=$(this).data("submit-button-id"),submitButton=$("#"+submitId);return submitButton.attr("disabled","disabled"),!0})},doubleClickPrevention=new DoubleClickPrevention,start=function(){doubleClickPrevention.start()},globals.DoubleClickPrevention={start:start}}(this),function(globals){"use strict";var init,selectToggle,SelectToggle;globals.DVSA||{};SelectToggle=function(){},SelectToggle.prototype.init=function(){var self=this;this.triggerElements=document.querySelectorAll("select[data-target]");for(var i=0;i<this.triggerElements.length;i++)!function(){var triggerEl=self.triggerElements[i],targetId=triggerEl.getAttribute("data-target"),targetEl=document.querySelector("#"+targetId),targetVal=triggerEl.getAttribute("data-target-value");triggerEl.setAttribute("aria-controls",targetId),window.addEventListener&&(triggerEl.addEventListener("keyup",function(){self.checkState(triggerEl,targetEl,targetVal)}),triggerEl.addEventListener("change",function(){self.checkState(triggerEl,targetEl,targetVal)})),self.checkState(triggerEl,targetEl,targetVal)}()},SelectToggle.prototype.checkState=function(triggerEl,targetEl,targetVal){for(var triggerMet=!1,targetVals=this.getTargetValues(targetVal),i=0;i<targetVals.length;i++)triggerEl.value===targetVals[i]&&(triggerMet=!0);triggerMet===!0?this.showContent(triggerEl,targetEl):(this.hideContent(triggerEl,targetEl),this.clearData(targetEl))},SelectToggle.prototype.getTargetValues=function(targetVal){return targetVal.split(",")},SelectToggle.prototype.clearData=function(target){var i,inputList=target.querySelectorAll('textarea:not([value=""]), input[type="text"], input[type="email"], input[type="password"], input[type="tel"]');for(i=0;i<inputList.length;++i){var leaveContentSwitch=$(inputList[i]).data("retain-value");leaveContentSwitch!==!0&&(inputList[i].value="")}},SelectToggle.prototype.hideContent=function(trigger,target){target.style.display="none",target.setAttribute("aria-hidden","true"),trigger.setAttribute("aria-expanded","false")},SelectToggle.prototype.showContent=function(trigger,target){target.style.display="block",target.setAttribute("aria-hidden","false"),trigger.setAttribute("aria-expanded","true")},selectToggle=new SelectToggle,init=function(){selectToggle.init()},globals.DVSASelectToggle={init:init,selectToggle:selectToggle}}(this),function(globals){"use strict";var init,loadingMessage;globals.DVSA||{};init=function(){loadingMessage()},loadingMessage=function(){globals.console.log("DVSA module template loaded.")},globals.DVSAModuleTemplate={init:init}}(this),function(globals){"use strict";var init,searchSuggest;globals.DVSA||{};searchSuggest=function(selector,dataSetID,prefetchURL,options){this.sourceJS="/public/javascripts/vendor/typeahead.min.js",this.selector=selector,this.dataSetID=dataSetID,this.prefetchURL=prefetchURL;var options=options||{};this.options={cache:options.cache||!1,minLength:options.minLength||3,limit:options.limit||8},this.init()},searchSuggest.prototype.init=function(){"function"!=typeof $.prototype.typeahead?this.loadJS(this.sourceJS,this.setup.bind(this)):this.setup()},searchSuggest.prototype.setup=function(){$(this.selector).typeahead([{name:this.dataSetID,prefetch:this.prefetchURL,cache:this.options.cache,minLength:this.options.minLength,limit:this.options.limit}])},searchSuggest.prototype.loadJS=function(src,cb){var ref=window.document.getElementsByTagName("script")[0],script=window.document.createElement("script");return script.src=src,script.async=!0,ref.parentNode.insertBefore(script,ref),cb&&"function"==typeof cb&&(script.onload=cb),script},init=function(){},globals.DVSAModuleSearchSuggest={init:init,searchSuggest:searchSuggest}}(this),function(globals){"use strict";globals.DVSA.Modules.DVSASelectToggle=DVSASelectToggle,globals.DVSA.Modules.DVSACriteria=DVSACriteria,globals.DVSA.Modules.DVSACookiesEnabled=DVSACookiesEnabled,globals.DVSA.Modules.DVSAShowHideToggle=DVSAShowHideToggle,globals.DVSA.Modules.DVSAShowHideToggleClasses=DVSAShowHideToggleClasses,globals.DVSA.Modules.DVSAShowHideToggleRadioClasses=DVSAShowHideToggleRadioClasses,globals.DVSA.Modules.DVSAMarkRepairs=DVSAMarkRepairs,globals.DVSA.Modules.DoubleClickPrevention=DoubleClickPrevention,globals.DVSA.init($({}))}(this);